# Week 12 评分标准：命令行习惯追踪器

## 总体评分

| 等级 | 分数 | 描述 |
|------|------|------|
| 优秀 | 90-100 | 功能完整，代码清晰，有扩展，有 AI 审查 |
| 良好 | 80-89 | 功能完整，代码可读，有日志和退出码 |
| 合格 | 60-79 | 基础功能可用，缺少日志或退出码 |
| 不合格 | 0-59 | 基础功能缺失或无法运行 |

---

## 基础题（40 分）

### 功能完整性（25 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| `add` 子命令 | 8 | 能添加习惯（5 分）；有 `--description` 参数（3 分） |
| `list` 子命令 | 8 | 能列出所有习惯（5 分）；有 `--active` 过滤（3 分） |
| `checkin` 子命令 | 7 | 能记录打卡（5 分）；打卡次数正确更新（2 分） |
| 数据持久化 | 2 | 用 JSON 文件存储，重启后数据还在 |

### 代码质量（10 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| argparse 使用正确 | 5 | 正确使用 `ArgumentParser`、`add_argument`、`add_subparsers` |
| 子命令路由清晰 | 3 | 用 `set_defaults(func=cmd_xxx)` 或等价方式路由 |
| 变量命名清晰 | 2 | 变量名有意义，不是 `x`、`temp` 这种 |

### 错误处理（5 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 文件不存在处理 | 2 | 第一次运行时自动创建 `habits.json` |
| 空输入检查 | 2 | 检查 `strip()`，防止空字符串 |
| 重复习惯检查 | 1 | 添加同名习惯时给出提示 |

**常见扣分点**：
- JSON 文件不存在时直接报错（-2 分）
- 没有检查空输入（-2 分）
- 重复添加同名习惯覆盖旧数据（-1 分）

---

## 进阶题（40 分）

### 功能扩展（20 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| `log` 子命令 | 6 | 能显示打卡历史（6 分） |
| `delete` 子命令 | 6 | 能删除习惯（6 分） |
| 退出码正确 | 5 | 成功返回 0，失败返回 1（5 分） |
| 日志记录 | 3 | 用 `logging` 模块，日志写入文件（3 分） |

### 退出码测试（10 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 成功情况返回 0 | 3 | 正常操作返回退出码 0 |
| 失败情况返回 1 | 4 | 不存在的习惯、空输入等返回 1 |
| 错误消息输出到 stderr | 3 | 用 `print(..., file=sys.stderr)` |

### 日志质量（10 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 日志格式正确 | 3 | 包含时间、级别、消息 |
| 日志级别合理 | 4 | INFO 用于正常操作，WARNING/ERROR 用于错误 |
| 日志内容清晰 | 3 | 日志消息有意义，不是 "出错了" 这种 |

**常见扣分点**：
- 错误消息输出到 stdout（-3 分）
- 所有情况都返回退出码 0（-4 分）
- 日志级别滥用（INFO 记录错误）（-2 分）
- 没有 `habit.log` 文件（-3 分）

---

## 挑战题（20 分，可选）

### 统计功能（8 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| `stats` 子命令 | 5 | 显示总习惯数、活跃习惯数、总打卡次数 |
| `--json` 参数 | 3 | 以 JSON 格式输出统计信息 |

### 全局参数（4 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| `--verbose` 参数 | 4 | 能控制日志级别（DEBUG/INFO） |

### 额外功能（8 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 打卡连胜（streak） | 4 | 计算并显示当前连续打卡天数 |
| 最佳连胜 | 2 | 计算历史最长连续打卡 |
| `archive` 子命令 | 2 | 归档习惯（标记为不活跃） |

**说明**：
- 挑战题最多得 20 分
- 做一部分得一部分分（如做了 `stats` 但没做 `--json`，得 5 分）
- 超出 20 分按 20 分计

---

## AI 协作练习（10 分，可选）

### AI 代码质量（4 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 代码能运行 | 1 | `habit.py --help` 不报错 |
| 子命令设计合理 | 2 | 动词命名、参数符合直觉、帮助文档清晰 |
| 参数类型正确 | 1 | 位置/可选参数区分清楚 |

### 审查完整性（3 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 审查清单完整 | 3 | 审查清单中至少勾选了 6 项（共 10 项） |

### 审查报告质量（3 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 发现问题准确 | 2 | 指出 AI 代码的 2+ 个真实问题 |
| 修复说明清晰 | 1 | 说明修复了什么、为什么修复 |

**说明**：
- AI 协作练习最多得 10 分
- 没有提交 `ai_review.md` 不得分
- 审查报告太敷衍（如 "AI 写的很好，没问题"）得 0 分

---

## 代码风格与可读性（5 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 代码结构清晰 | 2 | 每个子命令独立函数，不堆在一起 |
| 注释适当 | 2 | 关键逻辑有注释，但不过度注释 |
| 符合 PEP 8 | 1 | 变量名、缩进、空行符合规范 |

**常见扣分点**：
- 所有逻辑堆在 `if __name__ == "__main__"` 里（-2 分）
- 完全没有注释（-1 分）
- 变量名不符合 PEP 8（如用 `驼峰式`）（-1 分）

---

## 测试与验证（5 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| 功能自测 | 3 | 所有子命令都能正常运行 |
| 边界测试 | 2 | 测试了空输入、不存在的习惯等边界情况 |

**说明**：
- 没有提交自测截图或说明不得分
- 只测试了正常情况，没测边界情况（-1 分）

---

## 提交规范（扣分项）

| 问题 | 扣分 |
|------|------|
| 没有提交到 Git 仓库 | -10 分 |
| 只有 1 次 Git 提交（draft + verify 要求至少 2 次） | -5 分 |
| 提交的文件无法运行 | 直接不合格（0 分） |
| 抄袭参考实现 | 直接不合格（0 分） |

---

## 总分计算

```
总分 = 基础题(40) + 进阶题(40) + 挑战题(20，可选) + AI 协作(10，可选) + 代码风格(5) + 测试(5) - 提交扣分

满分：100 分（不含挑战题和 AI 协作）
最高分：120 分（含挑战题和 AI 协作）
```

---

## 评分等级对照

| 等级 | 分数范围 | 描述 |
|------|----------|------|
| A+ | 95-100 | 优秀，所有功能完整，有扩展 |
| A | 90-94 | 优秀，功能完整，代码质量高 |
| B+ | 85-89 | 良好，功能完整，有少量瑕疵 |
| B | 80-84 | 良好，功能基本完整 |
| C+ | 75-79 | 合格，基础功能可用 |
| C | 60-74 | 合格，基础功能基本可用 |
| D | 40-59 | 不合格，基础功能缺失 |
| F | 0-39 | 不合格，无法运行或大部分功能缺失 |

---

## 验收标准（DoD）

### 最低通过标准（60 分）

- [ ] 基础题的 3 个子命令（add/list/checkin）能正常运行
- [ ] JSON 文件能正确读写
- [ ] 有基本的错误处理（文件不存在、空输入）

### 理想通过标准（80 分）

- [ ] 进阶题的 5 个子命令（add/list/checkin/log/delete）全部实现
- [ ] 退出码正确（成功 0，失败 1）
- [ ] 有日志记录到文件
- [ ] 代码结构清晰，可读性好

### 优秀标准（90+ 分）

- [ ] 所有基础题和进阶题要求满足
- [ ] 至少完成 1 个挑战题功能
- [ ] 或完成 AI 协作练习并有高质量审查报告
- [ ] 代码风格优秀，注释适当
- [ ] 有完整的自测说明

---

## 评分反馈模板

```
Week 12 作业评分反馈

学生：[姓名]
总分：[分数]/100

基础题（40 分）：[得分]
- [ ] add 子命令
- [ ] list 子命令
- [ ] checkin 子命令
- [ ] 数据持久化
- [ ] 错误处理

进阶题（40 分）：[得分]
- [ ] log 子命令
- [ ] delete 子命令
- [ ] 退出码正确
- [ ] 日志记录

挑战题（20 分，可选）：[得分]
- [ ] stats 子命令
- [ ] --verbose 参数
- [ ] 额外功能

AI 协作（10 分，可选）：[得分]
- [ ] AI 代码质量
- [ ] 审查完整性
- [ ] 审查报告质量

代码风格（5 分）：[得分]
测试验证（5 分）：[得分]

扣分项：
[ ] 提交规范问题

优点：
[列举 2-3 个做得好的地方]

改进建议：
[列举 2-3 个可以改进的地方]

总体评价：
[一段鼓励性反馈]
```

---

## 教师评分提示

### 快速检查方法

1. **功能测试**：运行所有子命令，看是否能正常工作
2. **退出码测试**：`echo $?` 检查退出码
3. **日志检查**：`cat habit.log` 看是否有日志
4. **代码审查**：看代码结构、变量命名、注释

### 常见问题预判

1. **JSON 文件被覆盖**：学生可能每次写文件前不读取，直接覆盖
2. **退出码总是 0**：忘记 `sys.exit(1)`
3. **错误消息在 stdout**：没有用 `file=sys.stderr`
4. **日志没有输出**：`logging.basicConfig` 的 `filename` 路径不对

### 鼓励性评语示例

- "子命令设计很清晰，参数符合直觉！"
- "日志记录很完整，排查问题会很方便。"
- "AI 审查报告写得很好，发现了几个关键问题。"
- "代码结构清晰，每个子命令独立封装，方便维护。"

### 改进建议示例

- "建议在添加习惯前检查是否已存在同名习惯。"
- "退出码可以更细致：文件不存在用 1，参数错误用 2。"
- "日志消息可以更具体：'添加习惯：xxx' 而不是 '操作成功'。"
- "建议用 `set_defaults(func=cmd_xxx)` 简化子命令路由。"
