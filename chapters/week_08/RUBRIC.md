# Week 08 评分标准

## 总分构成

| 维度 | 分值 | 说明 |
|------|------|------|
| 测试完整性 | 40 分 | 测试覆盖正常路径和边界情况，断言完整 |
| Fixture 使用 | 20 分 | 正确使用 fixture 管理测试数据 |
| 参数化测试 | 15 分 | 使用 @pytest.mark.parametrize 覆盖多种情况 |
| TDD 实践 | 15 分 | 展示完整的红-绿-重构循环 |
| 代码规范 | 10 分 | 命名规范、注释完整、测试可读性好 |

**总分**：100 分

---

## 评分细则

### 1. 测试完整性（40 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **测试函数数量** | 10 分 | - 至少 5 个测试函数（10 分）<br>- 3-4 个测试函数（6 分）<br>- 1-2 个测试函数（3 分） |
| **正常路径覆盖** | 15 分 | - 覆盖 add_task、mark_done、delete_task 全部功能（15 分）<br>- 覆盖 2 个功能（10 分）<br>- 只覆盖 1 个功能（5 分） |
| **边界情况覆盖** | 15 分 | - 覆盖无效索引、空列表等至少 2 种边界情况（15 分）<br>- 覆盖 1 种边界情况（8 分）<br>- 无边界情况测试（3 分） |

**扣分项**：
- 测试函数名不以 `test_` 开头导致 pytest 无法发现（-10 分）
- 断言不完整（只检查长度不检查内容）（-5 分/处）
- 测试之间互相依赖（一个测试失败导致其他测试失败）（-8 分）

---

### 2. Fixture 使用（20 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **Fixture 定义** | 8 分 | - 正确定义 fixture（@pytest.fixture 装饰器）（4 分）<br>- 返回合适的测试数据（4 分） |
| **Fixture 复用** | 8 分 | - 在 2+ 个测试函数中使用 fixture（8 分）<br>- 只在 1 个测试函数中使用（4 分） |
| **数据独立性** | 4 分 | - 每个测试使用独立的数据副本（4 分）<br>- 测试之间共享可变数据（-4 分） |

**常见扣分项**：
- fixture 没有使用 @pytest.fixture 装饰器（-4 分）
- 忘记在测试函数参数列表中声明 fixture（-4 分）
- fixture 返回可变对象且未做隔离，导致测试互相影响（-8 分）

---

### 3. 参数化测试（15 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **语法正确** | 5 分 | - 正确使用 @pytest.mark.parametrize（3 分）<br>- 参数列表格式正确（2 分） |
| **覆盖范围** | 6 分 | - 覆盖至少 4 种不同的输入情况（6 分）<br>- 覆盖 2-3 种（4 分）<br>- 只覆盖 1 种（2 分） |
| **边界情况** | 4 分 | - 包含边界值测试（如空字符串、超长字符串）（4 分）<br>- 只包含正常值（2 分） |

**注意**：此评分项针对进阶练习 3。如果学生未完成参数化测试，此项得 0 分。

---

### 4. TDD 实践（15 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **红阶段** | 5 分 | - 先写测试，运行看到失败（5 分）<br>- 未展示失败过程（2 分） |
| **绿阶段** | 5 分 | - 写最少代码让测试通过（5 分）<br>- 实现过于复杂（3 分） |
| **重构阶段** | 3 分 | - 在测试保护下重构代码（3 分）<br>- 未展示重构过程（1 分） |
| **文档记录** | 2 分 | - TDD_NOTES.md 记录了过程和反思（2 分） |

**注意**：此评分项针对进阶练习 4。如果学生未完成 TDD 练习，此项得 0 分。

**常见扣分项**：
- 先写实现再写测试（不是 TDD）（-10 分）
- 第一步没有看到测试失败（测试可能在测空气）（-5 分）

---

### 5. 代码规范（10 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **命名规范** | 4 分 | - 测试函数名清晰描述测试内容（2 分）<br>- 使用小写和下划线命名（2 分） |
| **注释与文档** | 3 分 | - 测试函数有 docstring 说明测试目的（2 分）<br>- 复杂断言有注释说明（1 分） |
| **代码可读性** | 3 分 | - 测试代码结构清晰（2 分）<br>- 断言条件易于理解（1 分） |

**扣分项**：
- 测试函数名不清晰（如 `test1`、`test_a`）（-2 分/处）
- 缺少 docstring（-1 分/函数）
- 代码格式混乱（缩进不一致、空行过多或过少）（-3 分）

---

## 等级标准

| 等级 | 分数范围 | 描述 |
|------|---------|------|
| **优秀（A）** | 90-100 分 | 测试覆盖完整，fixture 使用恰当，参数化测试设计合理，代码风格规范 |
| **良好（B）** | 80-89 分 | 测试覆盖较完整，能正确使用 fixture，代码风格基本规范 |
| **合格（C）** | 70-79 分 | 能完成基本测试，但边界情况覆盖不足，fixture 使用有改进空间 |
| **不合格（D）** | 60-69 分 | 代码能运行但测试存在明显问题，或缺少关键功能 |
| **不合格（F）** | < 60 分 | 代码无法运行，或未完成基础作业 |

---

## 常见扣分项速查表

| 问题 | 扣分 | 所属维度 |
|------|------|----------|
| 测试函数名不以 `test_` 开头 | -10 分 | 测试完整性 |
| pytest 无法发现测试（命名问题） | -10 分 | 测试完整性 |
| 断言不完整（只检查长度） | -5 分/处 | 测试完整性 |
| 测试之间互相依赖 | -8 分 | 测试完整性 |
| 缺少边界情况测试 | -8 分 | 测试完整性 |
| fixture 没有 @pytest.fixture 装饰器 | -4 分 | Fixture 使用 |
| 忘记在测试函数参数中声明 fixture | -4 分 | Fixture 使用 |
| fixture 数据未隔离导致测试互相影响 | -8 分 | Fixture 使用 |
| 参数化测试语法错误 | -5 分 | 参数化测试 |
| 参数化测试覆盖范围太小 | -4 分 | 参数化测试 |
| TDD 顺序错误（先实现后测试） | -10 分 | TDD 实践 |
| 未展示"红"阶段（测试失败） | -5 分 | TDD 实践 |
| 测试函数命名不清晰 | -2 分/处 | 代码规范 |
| 缺少 docstring | -1 分/函数 | 代码规范 |
| 代码格式混乱 | -3 分 | 代码规范 |

---

## 额外加分项（最多 +10 分）

| 加分项 | 分值 | 说明 |
|--------|------|------|
| 完成进阶练习 3（参数化测试） | +3 分 | 设计合理的测试矩阵 |
| 完成进阶练习 4（TDD 实践） | +5 分 | 展示完整的红-绿-重构循环 |
| 完成挑战练习 5（PyHelper 测试） | +5 分 | 测试覆盖率达到 80%+ |
| 完成 AI 协作练习 6 | +3 分 | 审查报告质量高，发现问题准确 |
| 代码质量特别优秀 | +2 分 | 超越基本要求，有创新点 |

**注意**：加分项总分不超过 10 分。

---

## 测试验证要求

### 自动测试（20 分）

运行 `python3 -m pytest chapters/week_08/tests -q` 必须通过：

```bash
$ python3 -m pytest chapters/week_08/tests -q
............                                                       [100%]
12 passed in 0.5s
```

**测试通过**：不扣分
**测试失败**：每个失败的测试 -2 分

### 手动验证（10 分）

Reviewer 会手动验证以下内容：

- [ ] 练习 1：测试函数数量 >= 5，覆盖正常路径和边界情况
- [ ] 练习 2：fixture 定义正确，在多个测试中复用
- [ ] 进阶练习 3（如完成）：参数化测试语法正确，覆盖多种输入
- [ ] 进阶练习 4（如完成）：展示了红-绿-重构过程

**每项不通过**：-2.5 分

---

## Reviewer 检查清单

### 测试完整性检查

- [ ] 测试函数名都以 `test_` 开头吗？
- [ ] 测试覆盖了 add_task、mark_done、delete_task 吗？
- [ ] 有测试边界情况（无效索引、空列表）吗？
- [ ] 断言是否完整（检查返回值和状态变化）？
- [ ] 测试之间是否独立（不互相影响）？

### Fixture 使用检查

- [ ] fixture 是否使用了 @pytest.fixture 装饰器？
- [ ] fixture 是否在测试函数参数中声明？
- [ ] fixture 返回的数据是否适合测试场景？
- [ ] 多个测试是否复用了同一个 fixture？

### 参数化测试检查（如完成）

- [ ] @pytest.mark.parametrize 语法是否正确？
- [ ] 是否覆盖了至少 4 种不同的输入？
- [ ] 是否包含边界值测试？

### TDD 实践检查（如完成）

- [ ] 是否先写测试再写实现？
- [ ] 是否展示了测试失败（红）的过程？
- [ ] 是否展示了重构过程？
- [ ] TDD_NOTES.md 是否记录了反思？

### 代码风格检查

- [ ] 测试函数命名是否清晰？
- [ ] 是否有 docstring 说明测试目的？
- [ ] 代码格式是否整洁？

---

## 反馈模板

Reviewer 在 PR 中给反馈时，可以使用以下模板：

```markdown
## Week 08 作业评分

### 得分：XX / 100

### 测试完整性（40 分）：XX / 40
- ✅ / ❌ 测试函数数量（XX / 10）
- ✅ / ❌ 正常路径覆盖（XX / 15）
- ✅ / ❌ 边界情况覆盖（XX / 15）

**问题**：
- （列出具体问题）

### Fixture 使用（20 分）：XX / 20
- ✅ / ❌ Fixture 定义（XX / 8）
- ✅ / ❌ Fixture 复用（XX / 8）
- ✅ / ❌ 数据独立性（XX / 4）

**问题**：
- （列出具体问题）

### 参数化测试（15 分）：XX / 15
- ✅ / ❌ 语法正确（XX / 5）
- ✅ / ❌ 覆盖范围（XX / 6）
- ✅ / ❌ 边界情况（XX / 4）

**问题**：
- （列出具体问题）

### TDD 实践（15 分）：XX / 15
- ✅ / ❌ 红阶段（XX / 5）
- ✅ / ❌ 绿阶段（XX / 5）
- ✅ / ❌ 重构阶段（XX / 3）
- ✅ / ❌ 文档记录（XX / 2）

**问题**：
- （列出具体问题）

### 代码规范（10 分）：XX / 10
- ✅ / ❌ 命名规范（XX / 4）
- ✅ / ❌ 注释与文档（XX / 3）
- ✅ / ❌ 代码可读性（XX / 3）

**问题**：
- （列出具体问题）

### 加分项：+XX / 10
- ✅ / ❌ 进阶练习 3（+3 分）
- ✅ / ❌ 进阶练习 4（+5 分）
- ✅ / ❌ 挑战练习 5（+5 分）
- ✅ / ❌ AI 协作练习 6（+3 分）
- ✅ / ❌ 代码质量特别优秀（+2 分）

### 总评

**优点**：
- （列出做得好的地方）

**改进建议**：
- （列出需要改进的地方）

### 是否需要修改后重新 review？
- [ ] 是，请在 XX 天内修改后重新提交
- [ ] 否，可以 merge
```

---

## 学生自检清单

在提交前，请确认：

### 测试完整性
- [ ] 至少 5 个测试函数，都以 `test_` 开头
- [ ] 覆盖 add_task、mark_done、delete_task 功能
- [ ] 覆盖至少 2 种边界情况
- [ ] 断言完整（检查返回值和状态变化）

### Fixture 使用
- [ ] 创建了至少 2 个 fixture
- [ ] fixture 使用了 @pytest.fixture 装饰器
- [ ] 在测试函数参数中声明了 fixture
- [ ] 测试数据相互独立

### 参数化测试（如完成）
- [ ] 使用了 @pytest.mark.parametrize
- [ ] 覆盖至少 4 种输入情况
- [ ] 包含边界值测试

### TDD 实践（如完成）
- [ ] 先写测试，看到失败
- [ ] 再写实现，测试通过
- [ ] 重构代码，测试仍通过
- [ ] 记录了 TDD 过程

### 代码规范
- [ ] 测试函数命名清晰
- [ ] 有 docstring 说明测试目的
- [ ] 代码格式整洁

### 测试验证
- [ ] 运行 `pytest` 通过所有测试
- [ ] 没有测试互相影响的问题

只有当以上所有项都打勾时，才建议提交作业。
