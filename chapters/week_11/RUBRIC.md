# Week 11 评分标准

## 总分构成

| 维度 | 分值 | 说明 |
|------|------|------|
| dataclass 定义与使用 | 35 分 | 正确定义和使用 dataclass，理解字段和默认值 |
| 类型提示完整性 | 25 分 | 正确使用类型提示，参数和返回值标注完整 |
| 状态管理实现 | 25 分 | 正确实现状态转换逻辑，非法转换能被阻止 |
| 代码质量与风格 | 15 分 | 命名规范、注释完整、符合 PEP 8 |

**总分**：100 分

---

## 评分细则

### 1. dataclass 定义与使用（35 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **练习 1：Student dataclass** | 10 分 | - 正确使用 `@dataclass` 装饰器（2 分）<br>- 所有字段都有类型提示（3 分）<br>- 默认值设置正确（2 分）<br>- 有默认值的字段位置正确（2 分）<br>- 能正确创建实例和访问字段（1 分） |
| **练习 3：Enum 状态定义** | 8 分 | - 正确定义 `EnrollmentStatus` 枚举（2 分）<br>- 枚举值有意义（2 分）<br>- 在 dataclass 中正确使用 Enum（2 分）<br>- 能正确访问枚举值（`.value`）（2 分） |
| **练习 4：JSON 转换** | 12 分 | - 正确使用 `asdict()` 函数（3 分）<br>- `to_dict()` 实现正确（3 分）<br>- `from_dict()` 处理字段缺失（4 分）<br>- `to_json()` 和 `from_json()` 实现正确（2 分） |
| **可变默认值处理** | 5 分 | - 使用 `field(default_factory=list)` 或 `__post_init__`（3 分）<br>- 理解为什么不能直接用 `[]`（2 分） |

**扣分项**：
- 忘记导入 `dataclass` 模块（-3 分）
- 类型提示语法错误（如把 `str` 写成 `"str"`）（-2 分/处）
- 有默认值的字段位置错误（-3 分）
- 可变默认值未正确处理（-5 分）
- `from_dict` 未处理字段缺失（-4 分）

---

### 2. 类型提示完整性（25 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **练习 2：函数类型提示** | 12 分 | - 所有函数参数都有类型提示（4 分）<br>- 所有函数都有返回值类型提示（4 分）<br>- 正确使用 `List`、`Optional`、`Dict`（4 分） |
| **dataclass 字段类型** | 6 分 | - 所有字段都有类型提示（3 分）<br>- 可选字段使用 `Optional`（3 分） |
| **复杂类型提示** | 4 分 | - 正确使用 `List[str]`、`Optional[str]` 等（2 分）<br>- 理解 `Optional[T]` 是 `Union[T, None]` 的简写（2 分） |
| **类型提示一致性** | 3 分 | - 类型提示与实际使用一致（2 分）<br>- 没有类型提示与默认值矛盾的情况（1 分） |

**扣分项**：
- 函数缺少类型提示（-2 分/函数）
- 类型提示语法错误（如 `list[str]` 在旧版本 Python 不支持但未说明）（-1 分/处）
- `Optional` 使用不当（如应该用 `Optional` 但用了具体类型）（-3 分/处）
- 类型提示与实际代码不符（-2 分/处）

---

### 3. 状态管理实现（25 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **练习 3：状态转换方法** | 10 分 | - `approve()` 方法实现正确（3 分）<br>- `reject()` 方法实现正确（3 分）<br>- `complete()` 方法实现正确（3 分）<br>- 状态转换逻辑正确（1 分） |
| **非法状态转换阻止** | 8 分 | - 所有非法转换都能被阻止（4 分）<br>- 抛出 `ValueError` 并给出清晰错误信息（4 分） |
| **状态转换规则完整** | 4 分 | - 转换规则设计合理（2 分）<br>- 状态转换图清晰（文档中说明）（2 分） |
| **边界情况处理** | 3 分 | - 处理空输入或无效输入（1 分）<br>- 处理重复转换（1 分）<br>- 优雅降级（1 分） |

**扣分项**：
- 状态转换没有检查当前状态（-5 分/方法）
- 非法转换没有被阻止（-4 分/处）
- 错误信息不清晰（-2 分/处）
- 状态转换规则不合理（-3 分）

---

### 4. 代码质量与风格（15 分）

| 评分项 | 分值 | 评分标准 |
|--------|------|----------|
| **命名规范** | 5 分 | - 类名用大驼峰（PascalCase）（2 分）<br>- 函数名用小写和下划线（snake_case）（2 分）<br>- 变量名有意义（1 分） |
| **注释与文档** | 5 分 | - dataclass 有 docstring（2 分）<br>- 函数有 docstring（2 分）<br>- 复杂逻辑有注释（1 分） |
| **代码结构** | 5 分 | - 正确导入模块（2 分）<br>- 避免重复代码（2 分）<br>- 适当的函数拆分（1 分） |

**扣分项**：
- 类名或函数名不符合规范（-2 分/处）
- 函数没有 docstring（-1 分/函数）
- dataclass 没有 docstring（-2 分）
- 代码格式混乱（缩进不一致）（-3 分）

---

## 等级标准

| 等级 | 分数范围 | 描述 |
|------|---------|------|
| **优秀（A）** | 90-100 分 | dataclass 定义正确，类型提示完整，状态管理逻辑清晰，代码健壮，风格规范 |
| **良好（B）** | 80-89 分 | dataclass 定义基本正确，类型提示较完整，状态管理有逻辑，代码较规范 |
| **合格（C）** | 70-79 分 | 能完成基本功能，状态管理有遗漏，类型提示不完整，代码有改进空间 |
| **不合格（D）** | 60-69 分 | 代码能运行但状态管理存在严重问题，或缺少关键类型提示 |
| **不合格（F）** | < 60 分 | 代码无法运行，或未完成基础作业 |

---

## 常见扣分项速查表

| 问题 | 扣分 | 所属维度 |
|------|------|----------|
| 代码无法运行（语法错误、导入错误） | -10 分/项 | dataclass 定义与使用 |
| 忘记导入 `dataclass` 模块 | -3 分 | dataclass 定义与使用 |
| 类型提示语法错误（如 `str` 写成 `"str"`） | -2 分/处 | 类型提示完整性 |
| 函数缺少类型提示 | -2 分/函数 | 类型提示完整性 |
| 可变默认值未正确处理（如 `tags: List[str] = []`） | -5 分 | dataclass 定义与使用 |
| 状态转换没有检查当前状态 | -5 分/方法 | 状态管理实现 |
| 非法状态转换没有被阻止 | -4 分/处 | 状态管理实现 |
| 错误信息不清晰 | -2 分/处 | 状态管理实现 |
| `from_dict` 未处理字段缺失 | -4 分 | dataclass 定义与使用 |
| 函数没有 docstring | -1 分/函数 | 代码质量与风格 |
| 类名不符合规范（如用 snake_case） | -2 分/处 | 代码质量与风格 |

---

## 额外加分项（最多 +10 分）

| 加分项 | 分值 | 说明 |
|--------|------|------|
| 完成进阶练习 5（带状态转换的 Enrollment） | +5 分 | 状态转换逻辑完整，辅助方法实现正确 |
| 完成进阶练习 6（重构字典为 dataclass） | +5 分 | 重构合理，对比说明清晰 |
| 完成 AI 协作练习 7 | +5 分 | 正确识别 AI 代码的问题并修复 |
| 代码质量特别优秀 | +2 分 | 超越基本要求，有创新点 |
| 使用 `mypy` 进行类型检查 | +2 分 | 代码通过 mypy 检查，无类型错误 |

**注意**：加分项总分不超过 10 分。

---

## 测试验证要求

### 自动测试（20 分）

运行 `python3 -m pytest chapters/week_11/tests -q` 必须通过：

```bash
$ python3 -m pytest chapters/week_11/tests -q
............                                                      [100%]
12 passed in 0.5s
```

**测试通过**：不扣分
**测试失败**：每个失败的测试 -2 分

### 手动验证（10 分）

Reviewer 会手动验证以下内容：

- [ ] 练习 1：`practice1_student_dataclass.py` 能正确创建 dataclass 实例
- [ ] 练习 2：`practice2_type_hints.py` 类型提示正确且功能正常
- [ ] 练习 3：`practice3_enum_status.py` 状态转换逻辑正确
- [ ] 练习 4：`practice4_json_conversion.py` JSON 转换正确

**每项不通过**：-2.5 分

---

## Reviewer 检查清单

### dataclass 定义检查

- [ ] 是否正确使用 `@dataclass` 装饰器？
- [ ] 所有字段是否有类型提示？
- [ ] 默认值设置是否正确？
- [ ] 有默认值的字段位置是否正确（在有默认值的无默认值的后面）？
- [ ] 可变默认值是否正确处理（`field(default_factory=list)` 或 `__post_init__`）？
- [ ] dataclass 是否有 docstring？

### 类型提示检查

- [ ] 所有函数参数是否有类型提示？
- [ ] 所有函数是否有返回值类型提示？
- [ ] 是否正确使用 `List`、`Optional`、`Dict`？
- [ ] 可选字段是否使用 `Optional`？
- [ ] 类型提示与实际代码是否一致？

### 状态管理检查

- [ ] 状态转换是否检查当前状态？
- [ ] 所有非法转换是否都被阻止？
- [ ] 错误信息是否清晰？
- [ ] 状态转换规则是否合理？
- [ ] 是否处理了边界情况？

### 代码风格检查

- [ ] 类名是否用大驼峰（PascalCase）？
- [ ] 函数名是否用小写和下划线（snake_case）？
- [ ] 函数是否有 docstring？
- [ ] dataclass 是否有 docstring？
- [ ] 代码缩进是否一致？

---

## 反馈模板

Reviewer 在 PR 中给反馈时，可以使用以下模板：

```markdown
## Week 11 作业评分

### 得分：XX / 100

### dataclass 定义与使用（35 分）：XX / 35
- ✅ / ❌ 练习 1：Student dataclass（XX / 10）
- ✅ / ❌ 练习 3：Enum 状态定义（XX / 8）
- ✅ / ❌ 练习 4：JSON 转换（XX / 12）
- ✅ / ❌ 可变默认值处理（XX / 5）

**问题**：
- （列出具体问题，如：`tags: List[str] = []` 应改为 `field(default_factory=list)`）

### 类型提示完整性（25 分）：XX / 25
- ✅ / ❌ 练习 2：函数类型提示（XX / 12）
- ✅ / ❌ dataclass 字段类型（XX / 6）
- ✅ / ❌ 复杂类型提示（XX / 4）
- ✅ / ❌ 类型提示一致性（XX / 3）

**问题**：
- （列出具体问题，如：`borrower_id: str = None` 应改为 `borrower_id: Optional[str] = None`）

### 状态管理实现（25 分）：XX / 25
- ✅ / ❌ 练习 3：状态转换方法（XX / 10）
- ✅ / ❌ 非法状态转换阻止（XX / 8）
- ✅ / ❌ 状态转换规则完整（XX / 4）
- ✅ / ❌ 边界情况处理（XX / 3）

**问题**：
- （列出具体问题，如：状态转换没有检查当前状态，允许了非法转换）

### 代码质量与风格（15 分）：XX / 15
- ✅ / ❌ 命名规范（XX / 5）
- ✅ / ❌ 注释与文档（XX / 5）
- ✅ / ❌ 代码结构（XX / 5）

**问题**：
- （列出具体问题）

### 加分项：+XX / 10
- ✅ / ❌ 进阶练习 5（+5 分）
- ✅ / ❌ 进阶练习 6（+5 分）
- ✅ / ❌ AI 协作练习 7（+5 分）
- ✅ / ❌ 代码质量特别优秀（+2 分）
- ✅ / ❌ 使用 mypy 检查（+2 分）

### 总评

**优点**：
- （列出做得好的地方）

**改进建议**：
- （列出需要改进的地方）

### 是否需要修改后重新 review？
- [ ] 是，请在 XX 天内修改后重新提交
- [ ] 否，可以 merge
```

---

## 学生自检清单

在提交前，请确认：

### dataclass 定义
- [ ] 所有 dataclass 都使用了 `@dataclass` 装饰器
- [ ] 所有字段都有类型提示
- [ ] 默认值设置正确
- [ ] 有默认值的字段放在没有默认值的字段后面
- [ ] 可变默认值使用 `field(default_factory=...)` 或 `__post_init__`
- [ ] dataclass 有 docstring

### 类型提示
- [ ] 所有函数参数都有类型提示
- [ ] 所有函数都有返回值类型提示
- [ ] 正确使用 `List`、`Optional`、`Dict`
- [ ] 可选字段使用 `Optional` 而不是具体类型
- [ ] 类型提示与实际代码一致

### 状态管理
- [ ] 状态转换检查当前状态
- [ ] 所有非法转换都能被阻止
- [ ] 错误信息清晰
- [ ] 处理了边界情况

### 代码质量
- [ ] 类名用大驼峰（PascalCase）
- [ ] 函数名用小写和下划线（snake_case）
- [ ] 函数有 docstring
- [ ] 代码格式整洁

### 测试验证
- [ ] 运行 `pytest` 通过所有测试
- [ ] 手动验证各功能正常

只有当以上所有项都打勾时，才建议提交作业。
