# Week 09 作业评分标准

## 评分概览

| 练习 | 类型 | 分值 | 通过标准 |
|------|------|------|----------|
| 练习 1 | 基础 | 20 分 | 字符串方法正确使用，边界情况处理 |
| 练习 2 | 基础 | 20 分 | split/join 正确使用，CSV 解析正确 |
| 练习 3 | 基础 | 25 分 | 正则表达式语法正确，匹配逻辑准确 |
| 练习 4 | 基础 | 25 分 | 综合运用字符串方法和正则，功能完整 |
| 代码质量 | - | 10 分 | 命名规范、注释清晰、边界处理 |
| **总计** | - | **100 分** | **60 分通过，80 分良好，90 分优秀** |

---

## 练习 1：字符串方法练习（20 分）

### 评分细则

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| `clean_log_line` 功能 | 6 分 | 正确去除首尾空白（2 分）；正确处理空行返回 None（2 分）；正确处理注释行返回 None（2 分） |
| `extract_timestamp` 功能 | 7 分 | 正确使用 `find()` 定位方括号（3 分）；正确提取时间戳内容（2 分）；格式错误时返回 None（2 分） |
| `extract_level` 功能 | 7 分 | 正确提取方括号和冒号之间的内容（3 分）；正确使用 `strip()` 去除空格（2 分）；转换为大写（2 分） |

### 常见扣分点

- 使用硬编码索引切片而不是 `find()`（-3 分）
- 忘记处理 `find()` 返回 -1 的情况（-2 分）
- 字符串不可变但未重新赋值（-2 分）
- 未去除换行符 `\n`（-1 分）

---

## 练习 2：split 和 join 练习（20 分）

### 评分细则

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| `parse_csv_line` 功能 | 8 分 | 正确使用 `split(",")`（3 分）；返回字典格式正确（3 分）；字段数量校验（2 分） |
| `filter_by_status` 功能 | 6 分 | 正确跳过表头（2 分）；正确过滤指定状态码（2 分）；返回格式正确（2 分） |
| `format_as_table` 功能 | 6 分 | 正确使用 `join()`（3 分）；表格格式正确（3 分） |

### 常见扣分点

- `split()` 和 `split(",")` 混淆（-3 分）
- `join()` 语法写反（-3 分）
- 未跳过表头行（-2 分）
- 字段数量不对时未返回 None（-2 分）

---

## 练习 3：正则表达式基础（25 分）

### 评分细则

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| `find_ip_addresses` 功能 | 8 分 | 使用原始字符串 `r"..."`（2 分）；正则语法正确（3 分）；正确使用 `findall()`（3 分） |
| `find_emails` 功能 | 8 分 | 正则语法正确（4 分）；正确处理邮箱中的特殊字符（2 分）；返回所有匹配（2 分） |
| `is_valid_phone` 功能 | 9 分 | 正则语法正确（4 分）；使用 `^` 和 `$` 限定边界（3 分）；返回布尔值（2 分） |

### 常见扣分点

- 正则字符串前未加 `r`（-2 分）
- IP 正则太宽松（匹配 999.999.999.999）（-2 分）
- 手机号正则未限制第二位为 3-9（-3 分）
- 使用 `re.match()` 但未从开头匹配（-2 分）
- 未正确处理空输入（-1 分）

---

## 练习 4：日志分析器扩展（25 分）

### 评分细则

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| `extract_urls` 功能 | 8 分 | 正则语法正确（4 分）；支持 http 和 https（2 分）；返回 URL 列表（2 分） |
| `analyze_error_types` 功能 | 9 分 | 正确提取日志级别（3 分）；正确统计各类别数量（3 分）；返回字典格式正确（3 分） |
| `find_slow_queries` 功能 | 8 分 | 正确提取耗时数字（3 分）；正确比较阈值（2 分）；返回格式正确（3 分） |

### 常见扣分点

- 正则贪婪匹配导致结果错误（未使用 `.*?`）（-3 分）
- 未处理日志格式不匹配的情况（-2 分）
- 提取数字后未转换为 int（-2 分）
- 未处理空输入或空列表（-1 分）

---

## 代码质量（10 分）

### 评分细则

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| 命名规范 | 3 分 | 函数名、变量名清晰有意义（3 分） |
| 注释和文档字符串 | 3 分 | 关键函数有 docstring（2 分）；复杂逻辑有注释（1 分） |
| 边界情况处理 | 4 分 | 空输入处理（2 分）；异常输入处理（2 分） |

### 常见扣分点

- 函数名不清晰（如 `f1`, `func`）（-2 分）
- 缺少 docstring（-2 分）
- 未处理空字符串/空列表（-2 分）
- 代码重复未提取函数（-1 分）

---

## 进阶作业评分（额外加分，最高 20 分）

### 挑战 1：URL 参数提取器（最高 10 分）

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| `parse_query_params` | 4 分 | 正确解析查询参数（2 分）；正确处理无参数情况（1 分）；返回字典格式正确（1 分） |
| `parse_path_params` | 3 分 | 正确分割路径（2 分）；正确处理前导斜杠（1 分） |
| `reconstruct_url` | 3 分 | 正确重建 URL（2 分）；正确处理参数拼接（1 分） |

### 挑战 2：编码问题处理（最高 10 分）

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| `safe_read_file` | 4 分 | 尝试多种编码（2 分）；正确处理编码错误（1 分）；返回文件内容（1 分） |
| `read_logs_with_fallback` | 4 分 | 跳过空行和注释（1 分）；记录错误行号（2 分）；返回正确格式（1 分） |
| `normalize_whitespace` | 2 分 | 正确规范化各种空白字符（2 分） |

---

## AI 协作练习评分（额外加分，最高 10 分）

### 审查报告评分

| 检查项 | 分值 | 评分标准 |
|--------|------|----------|
| 问题发现 | 4 分 | 找出至少 3 个问题（3 分）；问题分析准确（1 分） |
| 测试用例 | 3 分 | 为每个问题编写测试用例（2 分）；测试能证明问题存在（1 分） |
| 改进版本 | 2 分 | 修复所有发现的问题（1 分）；代码质量良好（1 分） |
| 思考总结 | 1 分 | 对 AI 生成代码 vs 人工编写有深入思考（1 分） |

---

## 测试通过标准

### 必做练习测试

```bash
# 所有基础练习测试必须通过
python3 -m pytest chapters/week_09/tests -v
```

### 测试覆盖要求

| 测试文件 | 必须覆盖的功能 |
|----------|----------------|
| `test_log_parser.py` | clean_log_line, extract_timestamp, extract_level |
| `test_csv_handler.py` | parse_csv_line, filter_by_status, format_as_table |
| `test_pattern_matcher.py` | find_ip_addresses, find_emails, is_valid_phone |
| `test_log_analyzer.py` | extract_urls, analyze_error_types, find_slow_queries |

---

## 评分等级

| 等级 | 分数范围 | 说明 |
|------|----------|------|
| 优秀 | 90-100 分 | 所有基础练习正确完成，代码质量高，有进阶或 AI 协作练习 |
| 良好 | 80-89 分 | 所有基础练习正确完成，代码质量良好 |
| 通过 | 60-79 分 | 基础练习基本完成，允许少量错误 |
| 需改进 | < 60 分 | 多个基础练习未完成或存在严重错误 |

---

## 提交检查清单

评分前确认以下文件存在且非空：

- [ ] `chapters/week_09/starter_code/log_parser.py`
- [ ] `chapters/week_09/starter_code/csv_handler.py`
- [ ] `chapters/week_09/starter_code/pattern_matcher.py`
- [ ] `chapters/week_09/starter_code/log_analyzer.py`
- [ ] `chapters/week_09/tests/` 目录下的测试文件
- [ ] （可选）`chapters/week_09/starter_code/url_parser.py`
- [ ] （可选）`chapters/week_09/starter_code/safe_reader.py`
- [ ] （可选）`chapters/week_09/ai_review_report.md`

---

## 快速评分流程

1. **运行测试**：`python3 -m pytest chapters/week_09/tests -v`
   - 全部通过：基础分 90 分起评
   - 部分失败：根据失败测试扣分

2. **代码审查**：
   - 检查命名规范和注释（±3 分）
   - 检查边界情况处理（±4 分）

3. **进阶练习**（如有）：
   - 运行进阶测试，根据通过情况加分（最高 20 分）

4. **AI 协作练习**（如有）：
   - 阅读 `ai_review_report.md`，根据质量加分（最高 10 分）

---

## 备注

- 正则表达式的准确性是本周评分重点，过于宽松或过于严格的模式都会扣分
- 鼓励学生在 AI 协作练习中展示批判性思维，发现 AI 代码的问题比修复更有价值
- 边界情况处理是工程能力的重要体现，本周对此有较高要求
